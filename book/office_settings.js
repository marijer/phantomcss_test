/*
  Require and initialise PhantomCSS module
  Paths are relative to CasperJs directory
*/

var phantomcss = require('./../phantomcss.js');

var utils = require('utils');

// get all new files

phantomcss.init({
  screenshotRoot: './screenshots/' + 'wrong aids' +'/'+'aid',
  failedComparisonsRoot: './screenshots/' + 'wrong aids' +'/failures'
});

var baseUrl = 'https://office.booking.com/affiliateadmin/affiliate.html?affiliate_id=';

var aids = ['380363','380456','380555','380557','380599','380389','380495','380319','380323','380327','380332','380334','380335','380338','380348','380353','380371','380393','380397','380400','380401','380403','380404','380422','380427','380429','380430','380432','380436','380441','380442','380445','380451','380459','380471','380481','380484','380496','380504','380513','380515','380519','380522','380523','380528','380531','380532','380535','380536','380537','380538','380539','380541','380549','380550','380551','380580','380582','380584','380587','380590','380593','380595','380597','380598','380622','380624','380317','380318','380320','380322','380326','380329','380336','380339','380341','380342','380343','380344','380349','380350','380351','380352','380355','380358','380366','380368','380370','380374','380375','380376','380377','380379','380381','380383','380387','380388','380390','380391','380392','380398','380402','380410','380411','380412','380414','380416','380417','380418','380423','380426','380428','380438','380440','380446','380447','380449','380452','380453','380460','380463','380464','380467','380468','380469','380470','380472','380475','380476','380477','380479','380483','380485','380486','380488','380489','380492','380493','380494','380512','380516','380520','380527','380534','380543','380545','380553','380558','380559','380560','380564','380565','380566','380567','380569','380570','380576','380577','380578','380579','380583','380585','380586','380588','380591','380619','380621','380627','380316','380324','380347','380362','380365','380382','380384','380394','380395','380405','380406','380413','380419','380431','380434','380450','380454','380474','380517','380518','380524','380533','380540','380571','380572','380574','380596','380617','380321','380325','380330','380331','380333','380337','380340','380345','380346','380356','380357','380359','380360','380361','380364','380367','380372','380373','380396','380399','380415','380421','380435','380443','380444','380448','380458','380461','380462','380465','380466','380473','380478','380482','380490','380491','380503','380505','380506','380521','380526','380530','380546','380548','380562','380575','380589','380620','380625','380626','380328','380354','380369','380433','380439','380455','380457','380480','380552','380556','380573','380380','380547','380568','380056','380138','380282','380172','380054','380173','380196','380157','380009','380014','380016','380017','380033','380036','380041','380042','380043','380051','380071','380085','380092','380094','380096','380097','380107','380108','380111','380128','380132','380135','380136','380170','380175','380178','380185','380190','380197','380199','380201','380203','380212','380223','380227','380243','380251','380252','380259','380277','380280','380281','380286','380287','380289','380290','380291','380293','380294','380296','380298','380299','380313','380008','380010','380011','380013','380019','380020','380024','380027','380029','380032','380045','380046','380048','380049','380050','380052','380083','380086','380087','380089','380090','380091','380093','380095','380098','380100','380102','380103','380116','380121','380122','380123','380124','380129','380130','380134','380141','380143','380145','380146','380147','380148','380149','380150','380151','380152','380153','380155','380156','380158','380159','380160','380161','380162','380163','380164','380165','380166','380167','380168','380169','380171','380174','380179','380180','380182','380183','380184','380188','380189','380191','380192','380193','380195','380198','380200','380202','380204','380213','380216','380217','380218','380220','380231','380236','380239','380241','380244','380245','380247','380257','380261','380263','380275','380278','380283','380284','380288','380292','380300','380301','380302','380303','380305','380306','380307','380309','380310','380311','380315','380025','380034','380037','380067','380101','380105','380110','380127','380137','380142','380194','380219','380221','380234','380240','380242','380255','380260','380273','380274','380279','380015','380018','380023','380026','380030','380031','380035','380038','380040','380044','380053','380055','380058','380060','380081','380084','380099','380104','380106','380113','380114','380115','380117','380120','380126','380139','380140','380154','380181','380186','380211','380214','380222','380224','380229','380232','380238','380248','380249','380253','380258','380262','380271','380272','380285','380308','380312','380314','380028','380125','380131','380133','380144','380210','380215','380225','380226','380228','380230','380233','380235','380237','380250','380295','380297','380304','380254' ]


casper.start();

// set username and password here 
casper.setHttpAuth('', '');

casper.each(aids, function(self, aid, i) {

  var url = baseUrl + aid;
 // console.log(url);

   this.thenOpen(url, function(){

  	  	this.echo(this.getTitle());
  	  	console.log(aid);
		
  	  	if (casper.test.assertSelectorHasText('a', "bookings2 (5)") ) {
  	  		console.log('hi');
  	  	} else {

  	  

		   casper.then(function(){
		       this.evaluate(function() {
		       	document.querySelector('select[name="parent_affiliate_id"]').selectedIndex = 1;
		          return true;
		       });

		     this.evaluate(function() {
	        		$('input[type="submit"]:first').click();
	    		});

		      casper.wait(15000, function(){
			          this.evaluate(function() {
				       	document.querySelector('select[name="parent_affiliate_id"]').selectedIndex = 2;
				         return true;
				       });

			 			this.evaluate(function() {
			        		$('input[type="submit"]:first').click();
			    		});

	// if(!casper.exists('#selector')){
	//    #selector doesn't exist
	// }

			 		  console.log(this.getCurrentUrl());
				     var hideElements = '';


				      console.log('done');
			    });

			});

		}
	});
});



casper.then( function end_it(){
  casper.test.done();
});

/*
Casper runs tests
*/
casper.run(function(){
  console.log('\nTHE END.');
  phantom.exit(phantomcss.getExitStatus());
});